#! /bin/bash
set -e

if [ -z "$NODE_ID" ]; then
  export NODE_ID="$(hostname)"
fi

#test -d /etc/consul.d || mkdir /etc/consul.d

if [ -n "$CONSUL_MASTER" ]; then
  /usr/local/bin/consul agent \
    -join $CONSUL_MASTER \
    -node $NODE_ID \
    -data-dir /tmp/consul \
    -bind 0.0.0.0 \
    -config-dir /etc/consul.d >> /var/log/consul.log 2>&1
else
  # Wait forever input
  cat
fi
